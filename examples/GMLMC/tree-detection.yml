# Min item specification for DeepForest model (https://github.com/weecology/DeepForest)
# Use this service to get a .json: https://onlineyamltools.com/convert-yaml-to-json
#
stac_version: 1.0.0-beta.2      # schema version
stac_extensions:  # stac exension required
  - dl-model      # deep-learning model extension
  - eo            # eo extesnion
  - scientific    # scientific extension required for citations
  - provider      # metadata about providers
id: 11234         # Some ID for this item
type: Feature     # Required by STAC item
geometry:         # Required by STAC item
  type: Polygon
  coordinates:
    - - - 180.0
        - 90.0
      - - -180.0
        - -90
      - - -180.0
        - 90.0
      - - 180.0
        - 90.0
      - - 180.0
        - -90.0
bbox:             # Required by STAC item
  - -180.0
  - -90.0
  - 180.0
  - 90 
collection: a eo model catalog  # name of the model catalog
#
# Links and assets (part of the core specs)
#
links:
  - rel: self
    href: https://landsat-stac.s3.amazonaws.com/some-eo-models/example-thelper-item.json
  - rel: collection
    href: https://landsat-stac.s3.amazonaws.com/some-eo-models/catalog.json
assets:
  - model_archive:
      href: https://github.com/weecology/DeepForest/releases/download/1.0.0/NEON.pt
      type: application/zip
      title: model archive
      description: model checkpoint from DeepForest 1.0 release
      role: 
        - model artefact
properties:
  #
  # General properties defined in the item core schema
  # 
  datetime: "2016-05-03T13:22:30Z"
  title: DeepForest        # short name of the model
  description: >-                  # short description
    RetinaNet architecture with a resnet50 backbone for Tree Crown Detection in Airborne RGB imagery        
  license: MIT                      # license of utilisation
  created: 2021-06-05
  updated: 2021-06-05
  # Section on instruments (core stac item)
  platform: Airborne
  gsd: 0.30
  # eo extension fields (describe the sensor spectal bands)
  eo:bands:
    - name: blue
      common_name: blue
      center_wavelength: 490
    - name: green
      common_name: green
      center_wavelength: 500
    - name: red
      common_name: red
      center_wavelength: 660
  #
  # Scientific references
  # Based on STAC scientific extension
  #
  sci:publications:                   # relevant publications
    - citation: >-
        Lin, Tsung-Yi, et al. "Focal loss for dense object detection." 
        Proceedings of the IEEE international conference on computer vision. 2017, 
        arXiv 1803.02579
  #
  #     Runtime metadata
  #     Describes the runtime environment
  #
  dlm:runtime:                              
    framework: PyTorch                 # deep learning framework used
    version: 1.9                       # framework version
    model_handler: trained_model.predict_file
    model_src_url: https://github.com/weecology/DeepForest
    model_commit_hash: 9ad0994f93e0648faee6a7d7ab757bde0e4bc939
    requirement_file: 
  #
  # Describe the content of the model archive
  #
  dlm:archive:                            
    - name: data.pkl
      role:
      - serialized pickle file
    - name: ./data
      role:
      - model weight
    - name: version
      role:
      - model version
  #
  # EO data description (required)
  #
  dlm:data:
    process_level: ortho # expected processing level
    dtype: byte        # data type (enum)
    number_of_bands: 3  # number of bands in the test file

  #
  # Model input description (required)
  #
  dlm:inputs:         
    name: data        # expected variable name
    input_tensors:
      batch: 1    # batch size
      channels: 3 # number of channels
      height: 224 # tensor height
      width: 224  # tensor width
    scaling_factor: 0.003921569  # scaling factor (usually 1/255)
    normalization:mean:        # input statistical normalization (mean)
      - 0.0
      - 0.0
      - 0.0
    normalization:std:        # input statistical normalization (std)
      - 1.0
      - 1.0
      - 1.0
    selected_bands:           # selected bands (0 is the first band)
      - 0
      - 1
      - 3
    pre_processing_function: built-in
  #
  # Model output description (required)
  #
  dlm:outputs:
    task: object detection   # describe the ML task (enum)
    number_of_classes: 9          # number of classes
    final_layer_size:                         # size of the output
      - 1
      - 9           
    class_name_mapping:                # mapping to short class names
      - 0: Tree
    post_processing_function: built-in
 